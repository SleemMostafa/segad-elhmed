@page "/categories/create"
@using MediatR
@using Application.Commands
@using Application.DTOs
@inject IMediator Mediator
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Create Category</PageTitle>

<div class="form-container">
    <div class="form-header">
        <a href="/categories" class="back-link">
            <i class="bi bi-arrow-left"></i> Back to Categories
        </a>
        <h1 class="mt-3">
            <i class="bi bi-folder-plus text-primary"></i>
            Create New Category
        </h1>
        <p class="text-muted">Add a new category to organize your carpet inventory</p>
    </div>

    <EditForm Model="@createDto" OnValidSubmit="@HandleSubmit" FormName="createCategory">
        <DataAnnotationsValidator />

        <div class="form-card">
            <div class="form-section">
                <h5 class="section-title">
                    <i class="bi bi-info-circle"></i>
                    Category Information
                </h5>

                <div class="mb-4">
                    <label for="name" class="form-label">Category Name <span class="text-danger">*</span></label>
                    <InputText id="name" class="form-control form-control-lg" @bind-Value="createDto.Name" 
                             placeholder="e.g., Persian Carpets, Modern Rugs, Oriental" />
                    <ValidationMessage For="@(() => createDto.Name)" class="validation-message" />
                </div>

                <div class="mb-4">
                    <label for="description" class="form-label">Description</label>
                    <InputTextArea id="description" class="form-control" @bind-Value="createDto.Description" 
                                 rows="4" placeholder="Enter a detailed description of this category..." />
                    <ValidationMessage For="@(() => createDto.Description)" class="validation-message" />
                    <small class="text-muted">Optional: Add details to help identify this category</small>
                </div>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">
                <i class="bi bi-exclamation-triangle me-2"></i>@errorMessage
            </div>
        }

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-lg" disabled="@isSubmitting">
                @if (isSubmitting)
                {
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                    <span>Creating...</span>
                }
                else
                {
                    <i class="bi bi-check-circle me-2"></i>
                    <span>Create Category</span>
                }
            </button>
            <a href="/categories" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-x-circle me-2"></i>Cancel
            </a>
        </div>
    </EditForm>
</div>

<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .form-header {
        margin-bottom: 2rem;
    }

    .back-link {
        color: var(--text-secondary);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .back-link:hover {
        color: var(--primary-color);
        transform: translateX(-4px);
    }

    .form-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
    }

    .form-section {
        padding: 2rem;
    }

    .section-title {
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f3f4f6;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-title i {
        color: var(--primary-color);
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        padding: 1.5rem;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
</style>

@code {
    [SupplyParameterFromForm]
    private CreateCategoryDto createDto { get; set; } = new();

    private bool isSubmitting = false;
    private string? errorMessage;

    private async Task HandleSubmit()
    {
        try
        {
            isSubmitting = true;
            errorMessage = null;
            
            await Mediator.Send(new CreateCategoryCommand(createDto));
            Navigation.NavigateTo("/categories");
        }
        catch (Exception ex)
        {
            errorMessage = $"Error creating category: {ex.Message}";
        }
        finally
        {
            isSubmitting = false;
        }
    }
}
